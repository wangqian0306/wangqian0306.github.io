---
title: Next.js
date: 2023-03-17 21:41:32
tags:
- "Node.js"
- "Next.js"
- "React"
id: next.js
no_word_count: true
no_toc: false
categories:
- "前端"
---

## Next.js

### 简介

Next.js 是一个用于生产环境的 React 应用框架。Redux 则是一种模式和库，用于管理和更新应用程序状态，使用称为“操作”的事件。它是需要在整个应用程序中使用的状态的集中存储，规则确保状态只能以可预测的方式更新。

### 创建项目

在安装完 Node 之后就可以使用如下命令快速生成项目

```bash
npx create-next-app@latest
```

> 注：剩余配置全部默认即可

### MUI 插件

使用如下命令安装即可：

```bash
npm install @mui/material @emotion/react @emotion/styled @mui/material-nextjs @emotion/cache
```

#### 与 Next.js 带主题集成并进行本地化

主题配置类如下 `app/theme.ts`：

```typescript jsx
'use client';

import { Roboto } from 'next/font/google';
import { createTheme } from '@mui/material/styles';

const roboto = Roboto({
  weight: ['300', '400', '500', '700'],
  subsets: ['latin'],
  display: 'swap',
});

const theme = createTheme({
  typography: {
    fontFamily: roboto.style.fontFamily,
  },
});

export default theme;
```

向 layout 文件 `app/layout.tsx` 中引入主题配置类：

```typescript jsx
import type {Metadata} from 'next'
import {Inter} from 'next/font/google'
import './globals.css'
import {ThemeProvider} from '@mui/material/styles';
import {AppRouterCacheProvider} from '@mui/material-nextjs/v14-appRouter'
import theme from "@/app/theme";

const inter = Inter({subsets: ['latin']})

export const metadata: Metadata = {
  title: 'Create Next App',
  description: 'Generated by create next app',
}

export default function RootLayout({
                                     children,
                                   }: {
  children: React.ReactNode
}) {
  return (
    <html lang="en">
    <body className={inter.className}>
    <AppRouterCacheProvider options={{key: 'css', enableCssLayer: true}}>
      <ThemeProvider theme={theme}>
        {children}
      </ThemeProvider>
    </AppRouterCacheProvider>
    </body>
    </html>
  )
}
```

#### 自定义带参数 mui 插件

```typescript jsx
import * as React from 'react';
import { styled } from '@mui/material/styles';
import Slider, { SliderProps } from '@mui/material/Slider';

interface StyledSliderProps extends SliderProps {
  success?: boolean;
}

const StyledSlider = styled(Slider, {
  shouldForwardProp: (prop) => prop !== 'success',
})<StyledSliderProps>(({ success, theme }) => ({
  ...(success &&
    {
      // TODO
    }),
}));
```

#### 自定义主题参数

```typescript jsx
declare module '@mui/material/styles' {
  interface Theme {
    status: {
      danger: string;
    };
  }
  // allow configuration using `createTheme`
  interface ThemeOptions {
    status?: {
      danger?: string;
    };
  }
}
```

#### 日期选择器

安装依赖：

```bash
npm install @mui/x-date-pickers dayjs
```

然后需要在使用日期选择器的使用页面编写如下代码即可

```typescript jsx
'use client';

import {LocalizationProvider} from '@mui/x-date-pickers';
import {AdapterDayjs} from "@mui/x-date-pickers/AdapterDayjs";
import {DatePicker} from "@mui/x-date-pickers";

export default function Home() {
  return (
    <LocalizationProvider dateAdapter={AdapterDayjs} adapterLocale="zh-cn">
      <main className="flex min-h-screen flex-col items-center justify-between p-24">
        <DatePicker/>
      </main>
    </LocalizationProvider>
  );
}
```

#### 复杂表格

需要额外安装插件：

```bash
npm install @mui/x-data-grid
```

然后即可编辑如下样例表格：

```typescript jsx
'use client'

import * as React from "react";
import {
    DataGrid,
    gridFilteredTopLevelRowCountSelector,
    gridPageSizeSelector,
    GridPagination,
    GridToolbarContainer,
    GridToolbarExport,
    GridToolbarColumnsButton,
    GridToolbarFilterButton,
    GridToolbarDensitySelector,
    useGridApiContext,
    useGridRootProps,
    useGridSelector
} from "@mui/x-data-grid";
import {createFakeServer} from "@mui/x-data-grid-generator";
import MuiPagination from "@mui/material/Pagination";
import {TablePaginationProps} from "@mui/material/TablePagination";
import {Box} from "@mui/material";
import { Input as BaseInput } from '@mui/base/Input';

const SERVER_OPTIONS = {
    useCursorPagination: false,
};

const {useQuery, ...data} = createFakeServer({}, SERVER_OPTIONS);

const getPageCount = (rowCount: number, pageSize: number): number => {
    if (pageSize > 0 && rowCount > 0) {
        return Math.ceil(rowCount / pageSize);
    }

    return 0;
};

function MyToolbar(props: any) {
    return (
        <Box sx={{
            display: "flex",
            justifyContent: "space-around",
            alignItems: "center",
            width: "100%"
        }}>
            <BaseInput
                value={props.value}
                onChange={props.change}
                placeholder={"Search by name"}
            />
            <GridToolbarContainer>
                <GridToolbarColumnsButton/>
                <GridToolbarFilterButton/>
                <GridToolbarDensitySelector/>
                <GridToolbarExport/>
            </GridToolbarContainer>
        </Box>
    )
}

function Pagination({
                        page,
                        onPageChange,
                        className,
                    }: Pick<TablePaginationProps, "page" | "onPageChange" | "className">) {
    const apiRef = useGridApiContext();
    const rootProps = useGridRootProps();

    const pageSize = useGridSelector(apiRef, gridPageSizeSelector);
    const visibleTopLevelRowCount = useGridSelector(
        apiRef,
        gridFilteredTopLevelRowCountSelector
    );
    const pageCount = getPageCount(
        rootProps.rowCount ?? visibleTopLevelRowCount,
        pageSize
    );

    return (
        <MuiPagination
            showFirstButton={true}
            showLastButton={true}
            color="primary"
            className={className}
            count={pageCount}
            page={page + 1}
            onChange={(event, newPage) => {
                onPageChange(event as any, newPage - 1);
            }}
        />
    );
}

function CustomPagination(props: any) {
    return <GridPagination ActionsComponent={Pagination} {...props} />;
}

export default function ServerPaginationGrid() {
    const [paginationModel, setPaginationModel] = React.useState({
        page: 0,
        pageSize: 5,
    });

    const {isLoading, rows, pageInfo} = useQuery(paginationModel);

    // Some API clients return undefined while loading
    // Following lines are here to prevent `rowCountState` from being undefined during the loading
    const [rowCountState, setRowCountState] = React.useState(
        pageInfo?.totalRowCount || 0
    );
    const [searchText, setSearchText] = React.useState('');

    const handleSearch = (e: React.ChangeEvent<HTMLInputElement>) => {
        setSearchText(e.target.value);
    };
    React.useEffect(() => {
        setRowCountState((prevRowCountState) =>
            pageInfo?.totalRowCount !== undefined
                ? pageInfo?.totalRowCount
                : prevRowCountState
        );
    }, [pageInfo.totalRowCount, setRowCountState]);

    console.log(rowCountState);

    return (
        <div style={{height: 400, width: "100%"}}>
            <DataGrid
                rows={rows}
                {...data}
                rowCount={rowCountState}
                loading={isLoading}
                pageSizeOptions={[5, 10]}
                paginationModel={paginationModel}
                paginationMode="server"
                onPaginationModelChange={setPaginationModel}
                slots={{
                    pagination: CustomPagination,
                    toolbar: MyToolbar
                }}
                slotProps={{
                    toolbar: {
                        value: searchText,
                        change: handleSearch,
                    }
                }}
            />
        </div>
    );
}
```

> 注：表格中开放了很多的插槽，可以修改图标，完善翻页功能等，请参照 [官方文档](https://mui.com/x/api/data-grid/data-grid/#slots)

### chakra-ui 插件

使用如下命令安装即可：

```bash
npm i @chakra-ui/react @chakra-ui/next-js @emotion/react @emotion/styled framer-motion
```

在安装完成后需要编写 `src/app/provider.tsx` 文件，引入 ui 插件：

```typescript jsx
'use client'

import { CacheProvider } from '@chakra-ui/next-js'
import { ChakraProvider } from '@chakra-ui/react'

import { extendTheme } from '@chakra-ui/react'

const colors = {
    brand: {
        900: '#1a365d',
        800: '#153e75',
        700: '#2a69ac',
    },
}

export const theme = extendTheme({ colors })

export function Providers({
                              children,

                          }: {
    children: React.ReactNode
}) {
    return (
        <CacheProvider>
            <ChakraProvider theme={theme}>
                {children}
            </ChakraProvider>
        </CacheProvider>
    )
}
```

然后在 `src/app/layout.tsx` 文件中引入 `Provider`：

```typescript jsx
import type { Metadata } from 'next'
import { Inter } from 'next/font/google'
import { Providers} from "@/app/provider";
import './globals.css'

const inter = Inter({ subsets: ['latin'] })

export const metadata: Metadata = {
  title: 'Create Next App',
  description: 'Generated by create next app',
}

export default function RootLayout({
  children,
}: {
  children: React.ReactNode
}) {
  return (
    <html lang="en">
      <body className={inter.className}>
        <Providers>{children}</Providers>
      </body>
    </html>
  )
}
```

### chroma-js

chroma-js 是一个用于操作颜色的库。其在 typescript 中的安装方式如下：

```bash
npm install @types/chroma-js chroma-js
```

### 参考资料

[Next.js 官方文档](https://nextjs.org/docs/getting-started)

[Next.js 官方示例教程](https://nextjs.org/learn/dashboard-app)
